---
layout: post
title:  "Initial blog entry! Starts with 404 :-)"
date:   2021-07-04 13:38:13 +0200
categories: python
---
hi **@all**

everything begins with a problem so also this blog.

Currently I spent some free time to learn something about trading alrogithems. In general I want to build up knowledge to make in future decisions about the buy/sell of stocks and coins based on algorithems. Since two years I buy diffent assets based on my gut feeling but also sucessfully. 

However, now i want to change this and use in future more decisions based on algorithems and maybe, maybe one day also automated. 
For this I have done some researches via the web and found the python framework [mementum/backtrader][backtrader-gh].

Why backtrader?
---------------

The first observation feals really positiv. Close to have 7k stars, 2.1k forks and a simple getting started. What I also like here is that it's running localy. 
To give you a small impression about the usage here is the getting started code from the page where a simple SMA crossing algorithem is implemented:

{% highlight python %}
from datetime import datetime
import backtrader as bt

class SmaCross(bt.SignalStrategy):
    def __init__(self):
        sma1, sma2 = bt.ind.SMA(period=10), bt.ind.SMA(period=30)
        crossover = bt.ind.CrossOver(sma1, sma2)
        self.signal_add(bt.SIGNAL_LONG, crossover)

cerebro = bt.Cerebro()
cerebro.addstrategy(SmaCross)

data0 = bt.feeds.YahooFinanceData(dataname='MSFT', fromdate=datetime(2011, 1, 1),
                                  todate=datetime(2012, 12, 31))
cerebro.adddata(data0)

cerebro.run()
cerebro.plot()
{% endhighlight %}

This is fine for me. Nice seperation of concern and depedency injection ...

First run result into FileNotFound :-(
--------------------------------------

After running it without thinking too much I have received a irritating **FileNotFound** error message which is shown in the screenshot below:

![backtrader FileNotFount error](/frruity-blog/assets/images/backtrader_file_not_found_error.jpg)

Damn! I hate it really when a getting started is not working from the scratch. However let's figure out what happens. 

The **cerebro** class needs data wich are delivered via a file. This file is generated by the Yahoo parser module which is called here **YahooFinanceData**. This class is responsible for collecting the requested data from the Yahoo financial site. For this is using the common **requests** library but the **GET** operation results into a **404 - Page not found** :-(

{% highlight python %}
    ...
    sess = requests.Session()
    for i in range(self.p.retries + 1):  # at least once
        resp = sess.get(url, **sesskwargs)
        if resp.status_code != requests.codes.ok:
            continue
    ...
{% endhighlight %}

The page by itself exists but the requests library get's still the 404. After furter researches I have found out that the default User-Agent value from requests is not accpeted by Yahoo. By changing this into 'Mozilla/5.0' or something else the problem is solved and you will receive a **200 - OK**.

{% highlight python %}
    ...
    sess = requests.Session()
    sess.headers['User-Agent'] = 'Mozilla/5.0'
    ...
{% endhighlight %}

By default it looks like this

{% highlight python %}
>>> import requests
>>> s = requests.Session()
>>> s.headers['User-Agent']
'python-requests/2.25.1'
{% endhighlight %}

I have created a small pull requests to the guys now let's if it will be taken or if i will get any kind of feedback.

In general this showed me that the framework quality could be maybe low. Such a fundamental behaviour and it start direclty to fail and confuse the user. Not a good start.

Matplotlib via WSL2 and X11 Window
----------------------------------

After the first issues with a 404 the next problem commes direclty. backtrader is using like a lot of other frameworks the matplotlib which is great. So i tried to plot my results like in the example but no window has opened :-( Why?

It's my environment. 
I'm currently using Win10 with WSL2 and Ubuntu 20.04. 
The matplot lib is using by default python-tk which requires an X-Server on the Windows machine site. 

Thanks to the internet i found the following [stackoverflow question][stackoverflow-43397162] which is also no solving my complete issue. In addition to the installation of  **VcXsrv** i had to add some firewall rules to my Mcafee. I have decided to allow the complate IP range from 172.16.*


![x11 wsl2 firewall](/frruity-blog/assets/images/mcafe_wsl2_localhost_rules.jpg)

So even this issue has been finally solved. Hopefully i can start so to use backtrader and focus on the topic to execute back tests with a nice strategy.


First strategies implemented succesfully
----------------------------------------



Wrong assumtions
----------------

Buy and Buy strategie is not buying every month ;-(

Wrong assumtion that only a integer value can be buyed.


[backtrader-gh]: https://github.com/mementum/backtrader
[stackoverflow-43397162]: https://stackoverflow.com/questions/43397162/show-matplotlib-plots-and-other-gui-in-ubuntu-wsl1-wsl2
